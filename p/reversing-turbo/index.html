<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="A rabbit hole of reverse engineering, WMI calls, and kernel patches"><title>The Key That Did Nothing: My Journey Into the Linux Kernel</title><link rel=canonical href=https://hrideshmg.com/p/reversing-turbo/><link rel=stylesheet href=/scss/style.min.91c3fdefe9948c23de6fc967d5157338fc4f6a5b5d7f496ce98b7d5574bd4c1f.css><meta property='og:title' content="The Key That Did Nothing: My Journey Into the Linux Kernel"><meta property='og:description' content="A rabbit hole of reverse engineering, WMI calls, and kernel patches"><meta property='og:url' content='https://hrideshmg.com/p/reversing-turbo/'><meta property='og:site_name' content='Hridesh MG'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:published_time' content='2025-07-20T00:00:00+00:00'><meta property='article:modified_time' content='2025-07-20T22:43:49+05:30'><meta property='og:image' content='https://hrideshmg.com/p/reversing-turbo/cover.png'><meta name=twitter:title content="The Key That Did Nothing: My Journey Into the Linux Kernel"><meta name=twitter:description content="A rabbit hole of reverse engineering, WMI calls, and kernel patches"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='https://hrideshmg.com/p/reversing-turbo/cover.png'><link rel="shortcut icon" href=/favicon.png><script async src="https://www.googletagmanager.com/gtag/js?id=G-W0SXW6ZZ7V"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-W0SXW6ZZ7V")}</script></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu_1ee226403c585ea0.png width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>Hridesh MG</a></h1><h2 class=site-description>Welcome to my little corner on the internet :)</h2></div></header><ol class=menu-social><li><a href=https://github.com/hrideshmg target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://x.com/HrideshMg target=_blank title=Twitter rel=me><svg class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M22 4.01c-1 .49-1.98.689-3 .99-1.121-1.265-2.783-1.335-4.38-.737S11.977 6.323 12 8v1c-3.245.083-6.135-1.395-8-4 0 0-4.182 7.433 4 11-1.872 1.247-3.739 2.088-6 2 3.308 1.803 6.913 2.423 10.034 1.517 3.58-1.04 6.522-3.723 7.651-7.742a13.84 13.84.0 00.497-3.753C20.18 7.773 21.692 5.25 22 4.009z"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li><a href=/links/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Links</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#how-it-all-began>How it all began</a></li><li><a href=#let-the-tinkering-begin>Let the tinkering begin!</a><ol><li><a href=#finding-the-hidden-interface>Finding The Hidden Interface</a></li><li><a href=#playing-around-with-wmi>Playing around with WMI</a></li><li><a href=#wmi-explorer>WMI Explorer</a></li></ol></li><li><a href=#reversing-the-nitrosense-app>Reversing the NitroSense app</a><ol><li><a href=#fan-modes-cracked>Fan Modes Cracked</a></li><li><a href=#in-search-of-overclocks>In Search Of Overclocks..</a></li><li><a href=#the-final-piece-of-the-puzzle>The Final Piece Of The Puzzle</a></li><li><a href=#jackpot>Jackpot</a></li></ol></li><li><a href=#writing-the-patch>Writing The Patch</a></li><li><a href=#conclusion>Conclusion</a></li></ol></nav></div></section></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/p/reversing-turbo/><img src=/p/reversing-turbo/cover_hu_49fdeb3a97ddf715.png srcset="/p/reversing-turbo/cover_hu_49fdeb3a97ddf715.png 800w, /p/reversing-turbo/cover_hu_3d31db670304cc14.png 1600w" width=800 height=298 loading=lazy alt="Featured image of post The Key That Did Nothing: My Journey Into the Linux Kernel"></a></div><div class=article-details><header class=article-category><a href=/categories/dev/ style=background-color:#2a9d8f;color:#fff>Dev</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/reversing-turbo/>The Key That Did Nothing: My Journey Into the Linux Kernel</a></h2><h3 class=article-subtitle>A rabbit hole of reverse engineering, WMI calls, and kernel patches</h3></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Jul 20, 2025</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>9 minute read</time></div></footer></div></header><section class=article-content><p>As promised on my <a class=link href=https://hrideshmg.com/p/lfx-mentorship/#enabling-turbo-support-on-my-laptop>blog post</a> about the Linux Kernel mentorship program, this article will be about my endeavours in trying to enable turbo support for my laptop on Linux.</p><h2 id=how-it-all-began>How it all began</h2><p>It all started one day when I was sitting in front of my laptop completely zoned out. My eyes glanced upon the keyboard and I caught myself staring at a key which usually opens an app to change performance profiles of the laptop.</p><p>Now, much to the surprise of nobody, this key did not do anything on Linux since the NitroSense app (as is the case with most proprietary software) only works on Windows, regardless, I still wondered if it was possible to change thermal profiles on Linux. To my surprise, someone had already made a <a class=link href=https://github.com/JafarAkhondali/acer-predator-turbo-and-rgb-keyboard-linux-module target=_blank rel=noopener>kernel module</a> for this purpose! Unfortunately (or fortunately, since we wouldn&rsquo;t have this article otherwise :)) it only supported the Acer Predator Series of laptops, whereas my laptop was from the Nitro Series.</p><p>Anyways, it proved as a good starting point and while going through the source code of the project, I realized that this module was nothing more than a modified fork of a module from the platform profile subsystem on the kernel tree.</p><h2 id=let-the-tinkering-begin>Let the tinkering begin!</h2><h3 id=finding-the-hidden-interface>Finding The Hidden Interface</h3><p>After a brief skim through the project, I understood that things like RGB LEDs, fan profiles and certain other hardware related functionalities are often controlled through something known as <a class=link href=https://en.wikipedia.org/wiki/Windows_Management_Instrumentation target=_blank rel=noopener>WMI</a>, during this phase I also chanced upon a youtube <a class=link href="https://www.youtube.com/watch?v=97-WNhUmoig&amp;list=PLv2kA4LxAI4Dq2ic_hU9bdvxIzoz5SzBr" target=_blank rel=noopener>miniseries</a> created by the author of the project which gave me some great insight into how this project works under the hood.</p><p>In short, the WMI <a class=link href=https://docs.kernel.org/wmi/acpi-interface.html target=_blank rel=noopener>interface</a> allows software to communicate with the hardware by sending certain commands. These commands are handled by special WMI entries defined in the ACPI tables stored in the system firmware. That&rsquo;s a whole lot of words just to say â€” system send command, hardware do thing.</p><h3 id=playing-around-with-wmi>Playing around with WMI</h3><p>First off I started by randomly tweaking a few values in the source code (<em>sidenote: you probably shouldn&rsquo;t be doing this at the kernel level!</em>) and briefly got my fans to spin to their maximum speeds but the thermal profiles did not seem to budge, my CPU was still throttled at a respectable 3.2 GHz and I was none the wiser<br>Regardless, this confirmed my assumptions regarding WMI and thus I booted into Windows to monitor WMI activity and sure enough, whenever I changed thermal profiles using the app, a WMI event was registered on the <a class=link href=https://en.wikipedia.org/wiki/Event_Viewer target=_blank rel=noopener>Windows Event Viewer</a>.</p><p>The monitor told me that two WMI functions - <code>SetGamingFanBehavior</code> and <code>SetGamingMiscSetting</code> were called for changing fan speeds and applying overclocks respectively. Just knowing this alone wasn&rsquo;t enough though, I also needed to know what inputs are fed into these methods so that they actually do something. The event viewer, sadly, provided no means to track inputs.<br></p><h3 id=wmi-explorer>WMI Explorer</h3><p>Initially, I tried to do some trial and error using a tool I discovered called <a class=link href=https://github.com/vinaypamnani/wmie2 target=_blank rel=noopener>WMI Explorer</a> to manually invoke these functions but it didn&rsquo;t seem to do anything. I later realized that the only way to figure out the required inputs was to reverse engineer the program which calls the function.</p><p>I also made a small documentation <a class=link href="https://web.git.kernel.org/pub/scm/linux/kernel/git/next/linux-next.git/diff/Documentation/wmi/driver-development-guide.rst?id=98e45f0d7b99ceac029913ce3a161154a8c4c4a7" target=_blank rel=noopener>patch</a> during this time to mention this neat little tool in the WMI driver development <a class=link href=https://docs.kernel.org/wmi/driver-development-guide.html target=_blank rel=noopener>guide</a>.</p><h2 id=reversing-the-nitrosense-app>Reversing the NitroSense app</h2><p>Thus it began, my first foray into reverse engineering a real app. The NitroSense app was written in C# and thus I used dotPeek to decompile it.</p><h3 id=fan-modes-cracked>Fan Modes Cracked</h3><p>While searching for the input values for the overclock WMI call, I coincidentally chanced upon the function that was responsible for setting the fan modes â€”</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-C data-lang=C><span class=line><span class=cl><span class=n>public</span> <span class=k>static</span> <span class=kt>bool</span> <span class=nf>set_all_fan_mode</span><span class=p>(</span><span class=n>CommonFunction</span><span class=p>.</span><span class=n>Fan_Mode_Type</span> <span class=n>mode_index</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>ulong</span> <span class=n>intput</span> <span class=o>=</span> <span class=mi>9</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>switch</span> <span class=p>(</span><span class=n>mode_index</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=n>CommonFunction</span><span class=p>.</span><span class=n>Fan_Mode_Type</span><span class=p>.</span><span class=nl>Auto</span><span class=p>:</span>
</span></span><span class=line><span class=cl>      <span class=n>intput</span> <span class=o>|=</span> <span class=mi>4259840UL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=n>CommonFunction</span><span class=p>.</span><span class=n>Fan_Mode_Type</span><span class=p>.</span><span class=nl>Max</span><span class=p>:</span>
</span></span><span class=line><span class=cl>      <span class=n>intput</span> <span class=o>|=</span> <span class=mi>8519680UL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>case</span> <span class=n>CommonFunction</span><span class=p>.</span><span class=n>Fan_Mode_Type</span><span class=p>.</span><span class=nl>Custom</span><span class=p>:</span>
</span></span><span class=line><span class=cl>      <span class=n>intput</span> <span class=o>|=</span> <span class=mi>12779520UL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=p>((</span><span class=kt>int</span><span class=p>)</span> <span class=n>WMIFunction</span><span class=p>.</span><span class=nf>SetAcerGamingFanGroupBehavior</span><span class=p>(</span><span class=n>intput</span><span class=p>).</span><span class=nf>GetAwaiter</span><span class=p>().</span><span class=nf>GetResult</span><span class=p>()</span> <span class=o>&amp;</span> <span class=p>(</span><span class=kt>int</span><span class=p>)</span> <span class=n>byte</span><span class=p>.</span><span class=n>MaxValue</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>As we can see, input values of the WMI function are readily available here! There are three magic values which correspond to the three different fan modes. Was a bit surprised to the see the typo in the &lsquo;intput&rsquo; variable, kind of refreshing to know that even billion dollar companies have such mistakes in their code lol.</p><h3 id=in-search-of-overclocks>In Search Of Overclocks..</h3><p>The overclock function was sadly not as simple of an egg to crack. I traced through the GUI code for the app and narrowed it down to this particular function -</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-C data-lang=C><span class=line><span class=cl><span class=n>public</span> <span class=k>static</span> <span class=n>async</span> <span class=n>Task</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span> <span class=nf>set_operation_mode</span><span class=p>(</span><span class=kt>int</span> <span class=n>Operation_Mode</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>output</span> <span class=o>=</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>try</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>NamedPipeClientStream</span> <span class=n>cline_stream</span> <span class=o>=</span> <span class=n>new</span> <span class=nf>NamedPipeClientStream</span><span class=p>(</span><span class=s>&#34;.&#34;</span><span class=p>,</span> <span class=s>&#34;PredatorSense_service_namedpipe&#34;</span><span class=p>,</span> <span class=n>PipeDirection</span><span class=p>.</span><span class=n>InOut</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>cline_stream</span><span class=p>.</span><span class=nf>Connect</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=n>output</span> <span class=o>=</span> <span class=n>await</span> <span class=n>Task</span><span class=p>.</span><span class=n>Run</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>((</span><span class=n>Func</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>)</span> <span class=p>(()</span> <span class=o>=&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=n>IPCMethods</span><span class=p>.</span><span class=nf>SendCommandByNamedPipe</span><span class=p>(</span><span class=n>cline_stream</span><span class=p>,</span> <span class=mi>30</span><span class=p>,</span> <span class=p>(</span><span class=n>object</span><span class=p>)</span> <span class=p>(</span><span class=n>uint</span><span class=p>)</span> <span class=n>Operation_Mode</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=n>cline_stream</span><span class=p>.</span><span class=nf>WaitForPipeDrain</span><span class=p>();</span>
</span></span><span class=line><span class=cl>      <span class=n>byte</span><span class=p>[]</span> <span class=n>buffer</span> <span class=o>=</span> <span class=n>new</span> <span class=n>byte</span><span class=p>[</span><span class=mi>9</span><span class=p>];</span>
</span></span><span class=line><span class=cl>      <span class=n>cline_stream</span><span class=p>.</span><span class=nf>Read</span><span class=p>(</span><span class=n>buffer</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=n>buffer</span><span class=p>.</span><span class=n>Length</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=n>BitConverter</span><span class=p>.</span><span class=nf>ToInt32</span><span class=p>(</span><span class=n>buffer</span><span class=p>,</span> <span class=mi>5</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>})).</span><span class=nf>ConfigureAwait</span><span class=p>(</span><span class=nb>false</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>cline_stream</span><span class=p>.</span><span class=nf>Close</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>output</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nf>catch</span> <span class=p>(</span><span class=n>Exception</span> <span class=n>ex</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>output</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Don&rsquo;t worry if it all looks like gibberish to you, it did to me as well when I first came across it. Since i was wholly unfamiliar with the Windows API, I asked ChatGPT to explain the code to me like a 5 year old. GPT promptly explained that this function was creating something called a <a class=link href=https://en.wikipedia.org/wiki/Named_pipe target=_blank rel=noopener>&ldquo;Named Pipe&rdquo;</a> which is used for inter-process communication.</p><p>Uh oh, this meant that the actual WMI call was was being made by a process on the receiving end of this pipe. Interestingly, I noted that the name of the pipe was &lsquo;PredatorSense_<strong>service</strong>&rsquo;, suggesting that the recipient process was a service.</p><p>While we are here, let me also comment that the <code>Operation_Mode</code> argument of <code>set_operation_mode()</code> took one of three values: 0, 1 or 4. Which makes sense considering that my lapop has three performance modes.</p><h3 id=the-final-piece-of-the-puzzle>The Final Piece Of The Puzzle</h3><p>Sure enough, there was indeed a service in services.msc named <code>Predator Service</code>, the service started a program called <code>Pssvc.exe</code>. This particular program was written in C++, I initially used IDA to disassemble it before realizing that I had pretty much 0 knowledge of assembly ;-;</p><p>That&rsquo;s when I remembered Ghidra, a reversing tool developed by the NSA, that I had used during a CTF contest that I had played a long time ago. Ghidra tries its best to produce a readable C-like program from the disassembled code.</p><p>After some heavy decompiling on the service file using Ghidra I finally found out that the value is read from the named pipe and then used to call a function from a function pointer table as follows:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-C data-lang=C><span class=line><span class=cl><span class=p>(</span><span class=o>*</span><span class=p>(</span><span class=n>code</span> <span class=o>*</span><span class=p>)(</span><span class=o>&amp;</span><span class=n>PTR_LAB_140052c90</span><span class=p>)[</span><span class=n>uVar14</span><span class=p>])(</span><span class=n>puVar5</span><span class=p>,</span><span class=n>puVar8</span><span class=p>,</span><span class=o>&amp;</span><span class=n>local_250</span><span class=p>,</span><span class=o>&amp;</span><span class=n>local_244</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p>Here, <code>&amp;PTR_LAB_140052c90</code> refers to the following function pointer table -</p><img src=function_table.png width=480><p>If you remember from <a class=link href=#in-search-of-overclocks>earlier</a>, a command index of 30 was passed into the named pipe along with the Operation Mode. This index corresponds to the function pointer that I&rsquo;ve highlighted in the image.</p><p>I still needed to know what the arguments are for this function, here is the relevant section of the code which receives the input from the named pipe and calls this function â€”</p><img src=ghidra_decomp.png width=580><p>Yes, it&rsquo;s one hell of a monstrosityâ€”but after staring at it for a long time, I figured out that all it does is pass an array of bytes from the named pipe with their corresponding byte offsets to the function. You can observe this in the last line of code which actually performs the function call, <code>puVar5</code> is the array of bytes and <code>puVar8</code> are the byte offsets (I think anyways)</p><h3 id=jackpot>Jackpot</h3><p>Finally, we are ready to analyze the function that makes the WMI call â€”</p><img src=final_function.png width=580><p>This function dereferences the values from the byte array and performs a bitwise operation (<code>value &lt;&lt; 8 | 0xb;</code>) on them before passing them to the WMI call. Doing this manually on the <code>OperationMode</code> values from earlier, we get the following values for WMI calls:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=c1>//SetGamingMiscSetting
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>Performance</span>: <span class=mi>1035</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nb>Default</span>: <span class=mi>267</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Quiet</span>: <span class=mi>11</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>//SetGamingFanBehavior
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>Custom</span>: <span class=mi>12779520</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Auto</span>: <span class=mi>4259840</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Max</span>: <span class=mi>8519689</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>Using WMI Explorer to call this function with this values does indeed change performance profiles and fan speeds! All of this reversing had finally paid off! Or so I thought..</p><h2 id=writing-the-patch>Writing The Patch</h2><p>After all of that workâ€”reverse engineering the NitroSense app and painstakingly obtaining the correct values, I was ready to write my patch. Which is when I discovered that the kernel module, <a class=link href=https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/drivers/platform/x86/acer-wmi.c target=_blank rel=noopener>acer-wmi</a>, which adds WMI functionality to Linux for my laptop already had all of the above values defined! ðŸ™ƒ</p><p>Now this truly threw me for a loop, if someone had already taken the time to reverse these values why weren&rsquo;t they working on my laptop? Initially I thought this was because my turbo button was not producing a WMI event when pressed.</p><p>I <a class=link href="https://lore.kernel.org/platform-driver-x86/CALiyAom1xDH6A0Q2WNHCMUcpMJfM3pXO2DaW=bgHGUi8ZOpBbQ@mail.gmail.com/" target=_blank rel=noopener>reached out</a> the maintainers on the platform profile subsystem asking for help and they were more than ready to help. In fact, one of them even offered to write the patch for me! However since my main aim was to learn, I politely refused and he was kind enough to guide me in the right direction.</p><p>From there, I learnt about ACPI tables where these WMI functions are defined and the corresponding <a class=link href=https://unix.stackexchange.com/questions/534429/how-to-print-the-acpi-table target=_blank rel=noopener>tools</a> used to read them. After scanning through the ACPI code I realized that the Predator and Nitro series of laptops share the same values for the profiles and that the core issue was that the Predator series supports two additional profiles.</p><p>The <code>acer_wmi</code> module had the <code>supported_profiles</code> value hardcoded for the Predator. However, it should have been set dynamically, since the hardware had another WMI call (<code>GetGamingMiscSetting</code>) that returns a bitmap indicating the supported performance profiles. This function was simply not being utilised by the current driver.</p><p>Hence, my <a class=link href=https://lore.kernel.org/all/20250113-platform_profile-v4-0-23be0dff19f1@gmail.com/ target=_blank rel=noopener>patchset</a> essentially involved adding dynamic support for setting the supported platform profiles and some other miscellaneous improvements to the platform profile handling for acer laptops. After these patches got merged, I could finally set my performance profiles from the sysfs <a class=link href=https://docs.kernel.org/userspace-api/sysfs-platform_profile.html target=_blank rel=noopener>interface</a> at <code>/sys/firmware/acpi/platform_profile</code>!</p><p>We weren&rsquo;t done yet though. One last issue I was facing is that on Windows, my CPU was able to reach its max thermal limit of 100Â°C when operating in performance mode but on Linux, it was throttling at 92Â°C. I initially tried tweaking CPU frequency scaling drivers and other settings without success. After a lot of trial and error, a maintainer suggested installing <a class=link href=https://man.archlinux.org/man/extra/thermald/thermald.8.en target=_blank rel=noopener>thermald</a>â€”and that ended up solving the problem!</p><h2 id=conclusion>Conclusion</h2><p>That just about does it, in this rather wordy blog post I&rsquo;ve written down (almost) my complete approach to adding some unsupported functionality for my hardware to the Linux Kernel. Have to say, while it was certainly frustrating at times, it was a great deal of fun. Rarely do you actually get to go down to the basics like ACPI tables or manually juggle bitmasks to solve problems with your laptop. It&rsquo;s hard to explain but there is a sort of raw simplicity operating at such a low level, everything merely does what its meant to do and it does it well. There&rsquo;s no hidden abstractions or sneaky gotcha&rsquo;s that surprise you.</p><p>Going through this whole process also made me realize that you can literally solve any problem you have with software, as long as you have the grit to stick with it and see it through.</p></section><footer class=article-footer><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section><section class=article-lastmod><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<span>Last updated on Jul 20, 2025 22:43 +0530</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article class=has-image><a href=/p/lfx-mentorship/><div class=article-image><img src=/p/lfx-mentorship/cover.7310bbeb137fb3dbb4199375e67cc8e9_hu_71b7bb84380bad46.png width=250 height=150 loading=lazy alt="Featured image of post Linux Kernel Mentorship" data-key=lfx-mentorship data-hash="md5-cxC76xN/s9u0GZN15nzI6Q=="></div><div class=article-details><h2 class=article-title>Linux Kernel Mentorship</h2></div></a></article></div></div></aside><div id=remark42></div><script>var remark_config={host:"https://comments.hrideshmg.com",site_id:"remark",components:["embed"],url:"https://hrideshmg.com/p/reversing-turbo/",max_shown_comments:15,theme:document.documentElement.dataset.scheme,page_title:"The Key That Did Nothing: My Journey Into the Linux Kernel",locale:"en",show_email_subscription:!0};!function(e,t){for(s=0;s<e.length;s++){var s,n=t.createElement("script"),o=".js",i=t.head||t.body;"noModule"in n?(n.type="module",o=".mjs"):n.async=!0,n.defer=!0,n.src=remark_config.host+"/web/"+e[s]+o,i.appendChild(n)}}(remark_config.components||["embed"],document),window.addEventListener("onColorSchemeChange",e=>{window.REMARK42.changeTheme(e.detail)})</script><footer class=site-footer><section class=copyright>&copy;
2025 Hridesh MG</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.30.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>